<!DOCTYPE html>
<html lang="ko">
	<head>
		<%-include('partials/header.html') %>
	</head>
	<body>
		<div class="wrapper">
			<%-include('partials/sideBar.html') %>

			<div class="main">
				<%-include('partials/navigation.html') %>

				<main class="content">
					<div class="container-fluid p-0">
						<nav aria-label="breadcrumb">
							<ol class="breadcrumb">
							<li class="right-items"><h1 class="h3"><strong></strong>로그인 이력</h1></li>
							<li class="breadcrumb-item">이력 관리</li>
							<li class="breadcrumb-item">사용자 이력</li>
							<li class="breadcrumb-item" aria-current="page">로그인이력</li>
							</ol>
						</nav>
						<div class="row">
							<div class="card">
								<div class="card-header">
										<div class="row border-bottom-line">
											<div class="mb-3 col-2 col-xl-2">
												<div class="input-group date">
													<input id="startDateInput" type="text" class="form-control" placeholder="검색 시작일" value="<%=pageVO.getStartDate()%>" readonly>
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
												</div>
											</div>
											<div class="mb-3 col-2 col-xl-2">
												<div class="input-group date">
													<input id="endDateInput" type="text" class="form-control" placeholder="검색 종료일" value="<%=pageVO.getEndDate()%>" readonly>
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
												</div>
											</div>
											<div class="mb-3 col-4 col-xl-4">
											</div>
											<div class="mb-3 col-4 col-xl-4 d-flex justify-content-end">
												<form name="searchform" method="get">
													<input type="hidden" id="startDate" name="startDate">
													<input type="hidden" id="endDate" name="endDate">
													<input type="hidden" id="currentPage" name ="currentPage">
													<input type="hidden" id="pageMove" name ="pageMove">
													<button type="button" class="btn btn-primary btn-mg" onclick="movePage(''); return false;"><i class="align-middle" data-feather="search"></i> 조회</button>
													<button type="button" class="ml-1 btn btn-primary btn-mg" onclick="init(); return false;"><i class="align-middle" data-feather="rotate-ccw"></i> 초기화</button>
												</form>
											</div>
										</div>
								</div>
								<h6 class="card-subtitle text-muted">
									<p class="text-start"></p>
									<p class="text-end">검색결과: <Strong><%=pageVO.getTotal()%></Strong>건, &nbsp;<Strong><%=pageVO.getCurrentPage()%>/<%=pageVO.getTotalPages()%></Strong> 페이지</p>
								</h6>
								<table class="table table-striped table-bordered text-center">
									<colgroup>
										<col width="2%">
										<col width="10%">
										<col width="10%">
										<col width="10%">
										<col width="5%">
									</colgroup>
									<thead class="thead-dark">
										<tr>
											<th>번호</th>
											<th>접속ID</th>
											<th>로그인일시</th>
											<th>로그유형</th>
											<th>관리</th>
										</tr>
									</thead>
									<tbody>
										<% for(var i = 0; i < list.length; i++){ %>
											<tr>
												<td><%=(((pageVO.getCurrentPage() - 1) * pageVO.getSize()) + i + 1)%></td>
												<td><%=list[i].CONECT_ID%></td>
												<td class=""><%=list[i].CREAT_DT%></td>
												<td class="">
													<% if (list[i].CONECT_MTHD == 'IN') { %>
														로그인
													<% } else { %>
														로그아웃
													<% } %>
												</td>
												<td class="table-action">
													<a href="javascript:viewDetailLoginInfo('<%=list[i].LOG_ID%>');">
														<button class="btn btn-primary btn-sm" style="font-size: .4rem;">
															<i class="align-middle" data-feather="search"></i>
															이력상세보기
														</button>
													</a>
												</td>
											</tr>
										<% } %>
										<% if (list.length == 0) { %>
											<tr>
												<td style="text-align: center;" colspan="5">
													데이터가 존재하지 않습니다.
												</td>
											</tr>
										<% } %>

									</tbody>
								</table>
								<%-include('partials/paging.html') %>
							</div>
						</div>
						
						<div class="modal fade" id="defaultModalPrimary" tabindex="-1" aria-hidden="true">
							<div class="modal-dialog " role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title ml-1">
											<h4 class="mb-0">로그인상세</h4>
										</h5>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<div class="modal-body">
										<table class="table table-striped table-bordered text-center">
											<tr>
												<td>로그인일시</td>
												<td id="loginDate"></td>
											</tr>
											<tr>
												<td>로그인유형</td>
												<td id="loginType"></td>
											</tr>
											<tr>
												<td>로그인ID</td>
												<td id="loginId"></td>
											</tr>
											<tr>
												<td>로그인IP</td>
												<td id="loginIp"></td>
											</tr>
											<tr>
												<td>로그인사용자이름</td>
												<td id="loginName"></td>
											</tr>
										</table>	
									</div>
								</div>
							</div>
						</div>
					</div>
				</main>

			<footer class="footer">
				<%-include('partials/footer.html') %>
			</footer>
		</div>
	</div>

	<script>
		$('.input-group.date').datepicker({
			format: 'yyyy-mm-dd',
   			language: "ko",
			todayHighlight : true,
		});
		function viewDetailLoginInfo(logId) {
			$.ajax({
				url: '/manage/loginhistory/detailinfo',
				dataType: 'json',
				data: { logId:logId },
				type: 'GET',
				success: function(data) {
					$(".modal-body table td:nth-child(2)").text("");
					$("#loginDate").text(data.CREAT_DT);
					$("#loginType").text(data.CONECT_MTHD);
					$("#loginId").text(data.LOGIN_ID);
					$("#loginIp").text(data.CONECT_IP);
					$("#loginName").text(data.LOGIN_NM);
					$("#defaultModalPrimary").modal('toggle');
				},
				error : function(data, status, err) {
					console.log(err);
				}
			});
		}
		function movePage(curPage) {
			document.searchform.startDate.value = $("#startDateInput").val();
			document.searchform.endDate.value = $("#endDateInput").val();
			document.searchform.currentPage.value = curPage;
			document.searchform.submit();
		}
		function movePagePreNext(curPage, pageState) {
			document.searchform.startDate.value = $("#startDateInput").val();
			document.searchform.endDate.value = $("#endDateInput").val();
			document.searchform.pageMove.value = pageState;
			document.searchform.currentPage.value = curPage;
			document.searchform.submit();
		}
		function init() {
			$("#startDateInput").val('');
			$("#endDateInput").val('');
			document.searchform.startDate.value = '';
			document.searchform.endDate.value = '';
			document.location.reload();
		}
	</script>
</body>

</html>